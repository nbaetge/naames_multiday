---
title: "S4_Integration_Plots_Core"
author: "Nicholas Baetge"
date: "2/25/2021"
output: github_document
---

# Intro

Here, we plot the integrated from the multiday NAAMES station, N2S4.

```{r load packages, message = F, warning = F}
library(tidyverse)
library(lubridate)
library(hms)
library(zoo) 
library(oce)  
library(ggpubr)
library(patchwork)

```


# Import Data

```{r}
bf <- read_rds("~/GITHUB/naames_multiday/Output/integrated_bf.rds") %>% 
  filter(Cruise == "AT34", !plot_date %in% c("May 24 02:30", "May 27 06:07"))

phyto <- read_rds("~/GITHUB/naames_multiday/Output/integrated_phyto.rds") %>% 
  filter(station == "S4", !plot_date %in% c("May 24 02:30", "May 27 06:07")) %>% 
  pivot_longer(c(phyto_ez, phyto_mz), names_to = "dh", values_to = "phyto" ) %>% 
  select(date, time, plot_date, dh, phyto) %>% 
  mutate(dh = ifelse(dh == "phyto_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., read_rds("~/GITHUB/naames_multiday/Output/integrated_phyto.rds") %>% 
              filter(station == "S4", !plot_date %in% c("May 24 02:30", "May 27 06:07")) %>%
              pivot_longer(c(depthNerr_ez, depthNerr_mz), names_to = "dh", values_to = "err" ) %>% 
              select(date, time, plot_date, dh, err) %>% 
              mutate(dh = ifelse(dh == "depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  mutate(datetime = ymd_hms(paste(date, time)))

aou <- read_rds("~/GITHUB/naames_multiday/Output/integrated_aou.rds") %>% 
  filter(Cruise == "AT34", !plot_date %in% c("May 24 02:30", "May 27 06:07"))
```

# Plot Data

## Phyto


```{r}
phyto.plot <- phyto %>% 
  ggplot(aes(x = datetime, y = phyto, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = phyto - err, ymax = phyto + err),  width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("Phytoplankton, cells L"^"-1")), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 
  
```

## Chl

```{r}
chl.plot <- bf %>% 
  select(datetime, chl_ez, chl_mz, chl_depthNerr_ez, chl_depthNerr_mz) %>% 
  drop_na(chl_ez) %>% 
  pivot_longer(c(chl_ez, chl_mz), names_to = "dh", values_to = "chl" ) %>% 
  select(datetime, dh, chl) %>% 
  mutate(dh = ifelse(dh == "chl_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., bf %>% 
              select(datetime, chl_ez, chl_mz, chl_depthNerr_ez, chl_depthNerr_mz) %>% 
              drop_na(chl_ez) %>% 
              pivot_longer(c(chl_depthNerr_ez, chl_depthNerr_mz), names_to = "dh", values_to = "err" ) %>% 
              select(datetime, dh, err) %>% 
              mutate(dh = ifelse(dh == "chl_depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = datetime, y = chl, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = chl - err, ymax = chl + err),  width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("Chl ",italic("a"), ", µg L"^"-1")), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 
```


## BA

```{r bc plot, echo = FALSE, warning = FALSE, message = FALSE}
ba.plot <- bf %>% 
  select(datetime, ba_ez, ba_mz, ba_depthNerr_ez, ba_depthNerr_mz) %>% 
  drop_na(ba_ez) %>% 
  pivot_longer(c(ba_ez, ba_mz), names_to = "dh", values_to = "ba" ) %>% 
  select(datetime, dh, ba) %>% 
  mutate(dh = ifelse(dh == "ba_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., bf %>% 
              select(datetime, ba_ez, ba_mz, ba_depthNerr_ez, ba_depthNerr_mz) %>% 
              drop_na(ba_ez) %>% 
              pivot_longer(c(ba_depthNerr_ez, ba_depthNerr_mz), names_to = "dh", values_to = "err") %>% 
              select(datetime, dh, err) %>% 
              mutate(dh = ifelse(dh == "ba_depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = datetime, y = ba, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = ba - err, ymax = ba + err), width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("Bacterioplankton, cells L"^-1)), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 

```


## BCD

```{r bcd plot, echo = FALSE, warning = FALSE, message = FALSE}
bcd.plot <- bf %>% 
  select(datetime, bcd_ez, bcd_mz, bcd_depthNerr_ez, bcd_depthNerr_mz) %>% 
  drop_na(bcd_ez) %>% 
  pivot_longer(c(bcd_ez, bcd_mz), names_to = "dh", values_to = "bcd" ) %>% 
  select(datetime, dh, bcd) %>% 
  mutate(dh = ifelse(dh == "bcd_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., bf %>% 
              select(datetime, bcd_ez, bcd_mz, bcd_depthNerr_ez, bcd_depthNerr_mz) %>% 
              drop_na(bcd_ez) %>% 
              pivot_longer(c(bcd_depthNerr_ez, bcd_depthNerr_mz), names_to = "dh", values_to = "err") %>% 
              select(datetime, dh, err) %>% 
              mutate(dh = ifelse(dh == "bcd_depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = datetime, y = bcd/10^3, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = bcd/10^3 - err/10^3, ymax = bcd/10^3 + err/10^3), width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("BCD, µmol C L"^"-1", "d"^-1)), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 

```

## DOC

```{r doc plot, echo = FALSE, warning = FALSE, message = FALSE}
doc.plot <- bf %>% 
  select(datetime, doc_ez, doc_mz, doc_depthNerr_ez, doc_depthNerr_mz) %>% 
  drop_na(doc_ez) %>% 
  pivot_longer(c(doc_ez, doc_mz), names_to = "dh", values_to = "doc" ) %>% 
  select(datetime, dh, doc) %>% 
  mutate(dh = ifelse(dh == "doc_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., bf %>% 
              select(datetime, doc_ez, doc_mz, doc_depthNerr_ez, doc_depthNerr_mz) %>% 
              drop_na(doc_ez) %>% 
              pivot_longer(c(doc_depthNerr_ez, doc_depthNerr_mz), names_to = "dh", values_to = "err") %>% 
              select(datetime, dh, err) %>% 
              mutate(dh = ifelse(dh == "doc_depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = datetime, y = doc, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = doc - err, ymax = doc + err), width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("DOC, µmol C L"^-1)), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 

```


## N+N

```{r nn plot, echo = FALSE, warning = FALSE, message = FALSE}
n.plot <- bf %>% 
  select(datetime, n_ez, n_mz, n_depthNerr_ez, n_depthNerr_mz) %>% 
  drop_na(n_ez) %>% 
  pivot_longer(c(n_ez, n_mz), names_to = "dh", values_to = "n" ) %>% 
  select(datetime, dh, n) %>% 
  mutate(dh = ifelse(dh == "n_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., bf %>% 
              select(datetime, n_ez, n_mz, n_depthNerr_ez, n_depthNerr_mz) %>% 
              drop_na(n_ez) %>% 
              pivot_longer(c(n_depthNerr_ez, n_depthNerr_mz), names_to = "dh", values_to = "err") %>% 
              select(datetime, dh, err) %>% 
              mutate(dh = ifelse(dh == "n_depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = datetime, y = n, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = n - err, ymax = n + err), width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("N+N, µmol N L"^-1)), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 


```


## TDAA

```{r tdaay plot, echo = FALSE, warning = FALSE, message = FALSE}
tdaa.plot <- bf %>% 
  select(datetime, tdaa_ez, tdaa_mz, tdaa_depthNerr_ez, tdaa_depthNerr_mz) %>% 
  drop_na(tdaa_ez) %>% 
  pivot_longer(c(tdaa_ez, tdaa_mz), names_to = "dh", values_to = "tdaa" ) %>% 
  select(datetime, dh, tdaa) %>% 
  mutate(dh = ifelse(dh == "tdaa_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., bf %>% 
              select(datetime, tdaa_ez, tdaa_mz, tdaa_depthNerr_ez, tdaa_depthNerr_mz) %>% 
              drop_na(tdaa_ez) %>% 
              pivot_longer(c(tdaa_depthNerr_ez, tdaa_depthNerr_mz), names_to = "dh", values_to = "err") %>% 
              select(datetime, dh, err) %>% 
              mutate(dh = ifelse(dh == "tdaa_depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = datetime, y = tdaa, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = tdaa - err, ymax = tdaa + err), width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("TDAA, µmol C L"^-1)), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 


```


## AOU

```{r aou plot, echo = FALSE, warning = FALSE, message = FALSE}
aou.plot <- aou %>% 
  select(Date, aou_ez, aou_mz, depthNerr_ez, depthNerr_mz) %>% 
  drop_na(aou_ez) %>% 
  pivot_longer(c(aou_ez, aou_mz), names_to = "dh", values_to = "aou" ) %>% 
  select(Date, dh, aou) %>% 
  mutate(dh = ifelse(dh == "aou_ez", "Euphotic", "Upper Mesopelagic")) %>% 
  left_join(., aou %>% 
              select(Date, aou_ez, aou_mz, depthNerr_ez, depthNerr_mz) %>% 
              drop_na(aou_ez) %>% 
              pivot_longer(c(depthNerr_ez, depthNerr_mz), names_to = "dh", values_to = "err") %>% 
              select(Date, dh, err) %>% 
              mutate(dh = ifelse(dh == "depthNerr_ez", "Euphotic", "Upper Mesopelagic"))) %>% 
  ggplot(aes(x = Date, y = aou, color = dh, fill = dh)) +
  geom_line(size = 0.5, alpha = 0.7) +
  geom_errorbar(aes(ymin = aou - err, ymax = aou + err), width = 5000) +
  geom_point(color = "black", shape = 21, size = 3, alpha = 0.7) +
  labs(x = "", y = expression(paste("AOU, µmol O"[2], " L"^-1)), color = "", fill = "") +
  scale_fill_viridis_d(end = 0.7) +
  scale_color_viridis_d(end = 0.7) +
  guides(color = F, fill = F, shape = F, linetype = F) +
  scale_x_datetime( date_labels = c("%b %e", "%H:%M"), date_breaks = "12 hours") +
  theme_linedraw(base_size = 16) 
  

```



```{r combine plots, echo=FALSE, fig.height=14, fig.width=18, message=FALSE, warning=FALSE}

patchwork <-  phyto.plot + chl.plot + ba.plot +  bcd.plot + n.plot + aou.plot + doc.plot + tdaa.plot

patchwork +  
  plot_layout(guides = 'collect', ncol = 2) +
  plot_annotation(tag_levels = "a") &
  theme(plot.tag = element_text(size = 22),
        plot.title = element_text(size = 36)) 

```



